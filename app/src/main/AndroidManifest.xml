<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    package="com.example.arpackagevalidator">

    <!-- PERBAIKAN: Permissions yang lebih spesifik dan terorganisir -->
    
    <!-- AR dan Camera Permissions -->
    <uses-permission android:name="android.permission.CAMERA" />
    
    <!-- Storage Permissions - berbeda berdasarkan versi Android -->
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"
        android:maxSdkVersion="28" 
        tools:ignore="ScopedStorage" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" 
        android:maxSdkVersion="32" />
    
    <!-- PERBAIKAN: Internet permission untuk ARCore cloud features -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

    <!-- Hardware Features yang diperlukan -->
    <uses-feature 
        android:name="android.hardware.camera" 
        android:required="true" />
    <uses-feature 
        android:name="android.hardware.camera.autofocus" 
        android:required="false" />
    <uses-feature 
        android:name="android.hardware.camera.ar" 
        android:required="true" />

    <!-- PERBAIKAN: Sensor features yang diperlukan untuk AR -->
    <uses-feature
        android:name="android.hardware.sensor.accelerometer"
        android:required="true" />
    <uses-feature
        android:name="android.hardware.sensor.gyroscope"
        android:required="true" />

    <!-- OpenGL ES 3.0 untuk AR -->
    <uses-feature 
        android:glEsVersion="0x00030000" 
        android:required="true" />

    <application
        android:allowBackup="true"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.ARPackageValidator"
        android:hardwareAccelerated="true"
        android:largeHeap="true"
        tools:targetApi="31">

        <!-- PERBAIKAN: ARCore metadata dengan konfigurasi yang lebih lengkap -->
        <meta-data
            android:name="com.google.ar.core"
            android:value="required" />
        
        <!-- PERBAIKAN: ARCore configuration -->
        <meta-data
            android:name="com.google.ar.core.min_apk_version"
            android:value="232620000" />

        <!-- PERBAIKAN: FileProvider untuk sharing files dengan aman -->
        <provider
            android:name="androidx.core.content.FileProvider"
            android:authorities="${applicationId}.fileprovider"
            android:exported="false"
            android:grantUriPermissions="true">
            <meta-data
                android:name="android.support.FILE_PROVIDER_PATHS"
                android:resource="@xml/file_paths" />
        </provider>

        <activity
            android:name=".ui.MainActivity"
            android:exported="true"
            android:screenOrientation="portrait"
            android:configChanges="orientation|keyboardHidden|screenSize|screenLayout|uiMode"
            android:launchMode="singleTop"
            android:windowSoftInputMode="adjustResize">
            
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
            
            <!-- PERBAIKAN: Intent filter untuk ARCore -->
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
            </intent-filter>
        </activity>

        <!-- PERBAIKAN: Service untuk background processing jika diperlukan -->
        <service
            android:name=".service.MeasurementExportService"
            android:enabled="true"
            android:exported="false" />

    </application>

</manifest>
<!-- End of AndroidManifest.xml -->
<!-- 
PERBAIKAN YANG DILAKUKAN:
1. Tambahan permission INTERNET dan ACCESS_NETWORK_STATE untuk ARCore cloud features
2. Sensor features yang diperlukan untuk AR tracking
3. FileProvider untuk sharing files dengan aman
4. ARCore min version metadata
5. Hardware acceleration dan large heap untuk performance
6. ConfigChanges yang lebih lengkap untuk MainActivity
7. Intent filters yang lebih spesifik
8. Service declaration untuk background export processing
-->